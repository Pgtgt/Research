
import pandas as pd
import numpy as np
import os, tkinter, tkinter.filedialog, tkinter.messagebox
from scipy import interpolate
import matplotlib.pyplot as plt
import math
import sys


#データ読み込み

def FilefromDia():
    import os, tkinter, tkinter.filedialog, tkinter.messagebox
    root = tkinter.Tk()
    root.withdraw()
    fTyp = [("","*")]
    iDir = os.path.abspath(os.path.dirname(__file__))
    file = tkinter.filedialog.askopenfilename(filetypes = fTyp,initialdir = iDir)
    # 処理ファイル名の出力
    tkinter.messagebox.showinfo('○×プログラム',file)
    return file

def Inter(x,y,expnum): #x,yは信号 expnumはデータ分割数＝2**expnum/ 補間後信号return xinter,yinter,分割数Ninter,分割幅dx
    import sys
    from scipy import interpolate
    xinterstart=min(x)*(1+sys.float_info.epsilon)
    xinterend=max(x)*(1-sys.float_info.epsilon)
    Ninter=2**expnum
    xinter=np.linspace(xinterstart, xinterend, Ninter)
    
    SpFun=interpolate.interp1d(x,y,kind="cubic")
    yinter=SpFun(xinter)
    dx=(xinterend-xinterstart)/(Ninter-1) #サンプリング間隔
    return xinter,yinter,Ninter,dx
    
def OSAcsvfre_In(file): #fre-IのOSA信号(35行目から)をよむ
    import pandas as pd
    wholedata = pd.read_csv(file, header=None, skiprows=34).values
    Fdata=np.flipud(wholedata[:,0].ravel())#小さい周波数から格納
    Idata=np.flipud(wholedata[:,1].ravel())
    return Fdata,Idata
    
def FFT(x,y):
    N=len(x)
    FF=np.fft.fft(y)
    FF_abs=np.abs(FF)
    FF_abs_amp=FF_abs/(N/2)    
    dx=np.abs((x[-1]-x[0])/(N-1))
    f=np.linspace(0,1.0/dx,N)
    return f,FF,FF_abs_amp



file=FilefromDia()
# file="F:\研究\Data20191018\W0166.CSV"    

# Read CSV
Fdata,Idata=OSAcsvfre_In(file)

#補間
expnum=11
F,I,Ninter,dF=Inter(Fdata,Idata,expnum)

#FFTと
T,FF,FF_abs_amp=FFT(F,I)

plt.plot(T,FF_abs_amp)
plt.grid()
plt.show()